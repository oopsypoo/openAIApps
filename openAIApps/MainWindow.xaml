<Window x:Class="openAIApps.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:openAIApps"
        mc:Ignorable="d"
        Title="OpenAiApps" Height="768" Width="1080" Icon="/oai_small.png" >

    <Window.Resources>
        <!-- All text-boxes taking requests have this style -->
        <Style x:Key="TextBoxRequest" TargetType="TextBox">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="MinHeight" Value="250" />
            <Setter Property="Margin" Value="0,2,2,0" />
            <Setter Property="IsEnabled" Value="True" />
            <Setter Property="IsReadOnly" Value="False" />
            <Setter Property="Grid.Row" Value="1" />
            <Setter Property="Grid.Column" Value="0" />
            <Setter Property="AcceptsReturn" Value="True" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <Setter Property="TabIndex" Value="1" />
            <Setter Property="MaxHeight" Value="500" />
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}" >
                        <Border x:Name="bg" BorderThickness="1" BorderBrush="DarkGray" Background="White">
                            <Grid>
                                <ScrollViewer x:Name="PART_ContentHost" Focusable="True" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" />
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" TargetName="bg" Value="Black" />
                                <Setter Property="BorderThickness" TargetName="bg" Value="2"/>
                                <Setter Property="FontSize" Value="16" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <!-- All text-boxes receiving the AI-response have this style -->
        <Style x:Key="TextBoxResponse" TargetType="TextBox">
            <Setter Property="FontSize" Value="12" />

            <Setter Property="Margin" Value="2,0,2,0" />
            <Setter Property="IsEnabled" Value="True" />
            <Setter Property="IsReadOnly" Value="False" />
            <Setter Property="Grid.Row" Value="4" />
            <Setter Property="Grid.Column" Value="0" />
            <Setter Property="IsReadOnly" Value="True" />
            <Setter Property="TextWrapping" Value="Wrap" />
            <!--<Setter Property="MaxHeight" Value="300" />-->
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Visible" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}" >
                        <Border x:Name="bg" BorderThickness="1" BorderBrush="DarkGray" Background="White">
                            <Grid>
                                <ScrollViewer x:Name="PART_ContentHost" Focusable="True" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" />
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" TargetName="bg" Value="Black" />
                                <Setter Property="BorderThickness" TargetName="bg" Value="2"/>
                                <Setter Property="FontSize" Value="16" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SliderGPTOptions" TargetType="Slider">
            <Setter Property="SmallChange" Value="0.1" />
        </Style>
        <Style TargetType="GroupBox">
            <Setter Property="FontSize" Value="9"></Setter>
            <Setter Property="FontStyle" Value="Normal"></Setter>
        </Style>
        <Style TargetType="Label">
            <Setter Property="FontStyle" Value="Italic" />
            <Setter Property="Margin" Value="0,0,2,0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="DarkGray" />
        </Style>
        <Style x:Key="SendRequest" TargetType="Button">
            <Setter Property="Margin" Value="0,2,2,2" />
            <Setter Property="TabIndex" Value="2" />
            <Setter Property="Content" Value="Send Request" />
            <Setter Property="Grid.Row" Value="2" />
            <Setter Property="Grid.Column" Value="0" />
        </Style>
    </Window.Resources>

    <DockPanel LastChildFill="True" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" UseLayoutRounding="False" >

        <Menu DockPanel.Dock="Top" Height="18" IsEnabled="True" IsMainMenu="True">
            <MenuItem Header="File" Name="menuFile" Click="menuFile_Click" IsEnabled="True" AllowDrop="True">
                <MenuItem Header="Settings" x:Name="menuSettings"  IsEnabled="True" Click="menuSettings_Click"/>
                <MenuItem Header="Exit" Name="menuExit" Click="menuExit_Click" IsEnabled="True" />
            </MenuItem>
            <MenuItem Header="Tools" Name="menuTools" IsEnabled="True" AllowDrop="True">
                <MenuItem Header="Record sound" Name="menuRecord" Click="menuRecord_Click" IsEnabled="True" />
                <MenuItem Header="Convert WAV" Name="menuConvert" Click="menuConvert_Click"  IsEnabled="True" />
                <MenuItem Header="Play Sound File" Name="menuPlayFile" Click="menuPlayFile_Click"  IsEnabled="True" />
                <MenuItem Header="SpeechSynthesis Options" Name="menuSpeechSynthesisTool" Click="menuSpeechSynthesisTool_Click" IsEnabled="True" />
                <MenuItem Header="Available Models" Name="menuAvlblMdls" Click="menuAvailableModels_Click" IsEnabled="True" />
            </MenuItem>
            <MenuItem Header="Help" Name="menuHelp" Click="menuHelp_Click" IsEnabled="True" AllowDrop="True">
                <MenuItem Header="About" Name="menuAbout" Click="menuAbout_Click" IsEnabled="True"/>
                <MenuItem Header="ThisAssist" Name="menuThisAssistant" Click="menuThisAssistant_Click" IsEnabled="True"/>
            </MenuItem>
        </Menu>
        <TabControl x:Name="tabMain" DockPanel.Dock="Top" SelectionChanged="tabMain_SelectionChanged">
            <!-- ******************************************** -->
            <!-- Centered around Responses-tab(takes over for -->
            <!-- vision and image-generation) and video-tab.-->
            <!-- Not giving up/removing STT or TTS (whisper) yet-->
            <!-- ******************************************** -->


            <TabItem Header="Whisper"  Name="tpWhisper">
                <Grid x:Name="gridWhisper" VerticalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="cdWhisperReqRes" Width="185*"/>
                        <ColumnDefinition Width="621*"/>
                        <ColumnDefinition x:Name="cdWhisperOptions" Width="269*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Grid.Column="0" Grid.RowSpan="5" x:Name="spWhisperInput" Orientation="Vertical" Grid.ColumnSpan="3" Margin="0,0,268,0" >
                        <Label Grid.Row="0" Grid.Column="0">OpenAi response</Label>
                        <TextBox  Grid.Column="0" Style="{StaticResource TextBoxResponse}"  x:Name="txtWhisperPrompt" />
                        <Button  Grid.Column="0" Style="{StaticResource SendRequest}" x:Name="btnWhisperSendRequest" Click="btnWhisperSendRequest_Click"/>
                        <Label Grid.Row="3" Grid.Column="0">OpenAi response</Label>
                        <TextBox  Grid.Column="0" Style="{StaticResource TextBoxResponse}"  x:Name="txtWhisperResponse" />
                    </StackPanel>
                    <GroupBox x:Name="groupWhisper" Header="Whisper Options" Grid.Row="0" Grid.Column="2" Grid.RowSpan="5">
                        <StackPanel x:Name="spWhisper" Orientation="Vertical" Margin="5">
                            <Label Content="Speach to text" />
                            <ComboBox x:Name="cmbSpeachToText" IsEditable="False" IsReadOnly="True" SelectionChanged="cmbSpeachToText_SelectionChanged">
                                <ComboBoxItem IsSelected="True" Content="Transcription" />
                                <ComboBoxItem Content="Translation" />
                            </ComboBox>
                            <Label Content="Select an Audio File" />
                            <Button x:Name="btnAudioOpenFile" Content="Open Audiofile" Click="btnAudioOpenFile_Click" />
                            <Label x:Name="lblSelectedAudioFile" Content="Selected File" />
                            <Label Content="Select language below" />
                            <ComboBox x:Name="cmbLanguage" SelectionChanged="cmbLanguage_SelectionChanged">
                                <ComboBoxItem IsSelected="True" Content="en - English" />
                                <ComboBoxItem Content="nb - Norwegian" />
                                <ComboBoxItem Content="tl - Tagalog" />
                            </ComboBox>

                        </StackPanel>

                    </GroupBox>

                </Grid>
            </TabItem>
            <TabItem Header="Video"  Name="tpVideo">
                <Grid x:Name="gridVideo" VerticalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="cdVideoReqRes" Width="1.5*"/>
                        <ColumnDefinition x:Name="cdVideoOptions" Width="0.5*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Grid.Column="0" Grid.RowSpan="6" x:Name="spVideoInput" Orientation="Vertical" Grid.ColumnSpan="1">
                        <Label Grid.Row="1" Grid.Column="0" Margin="2,20,2,2">Video prompt</Label>
                        <TextBox Style="{StaticResource TextBoxRequest}"  x:Name="txtVideoPrompt" />
                        <Button Style="{StaticResource SendRequest}" x:Name="btnVideoSendRequest" Click="btnVideoSendRequest_Click"/>
                        <Label Grid.Row="3" Grid.Column="0" Margin="2,20,2,2">OpenAi response</Label>
                        <TextBox Style="{StaticResource TextBoxResponse}"  x:Name="txtVideoResponse" />
                        <MediaElement x:Name="mediaVideo" Margin="0,5,0,0" Height="200" LoadedBehavior="Manual" UnloadedBehavior="Stop"/>
                    </StackPanel>
                    <GroupBox x:Name="groupVideo" Header="Video Options" Grid.Row="0" Grid.Column="2" Grid.RowSpan="5">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel x:Name="spVideo" Orientation="Vertical" Margin="5">
                                <Label Content="Model" />
                                <ComboBox x:Name="cmbVideoModel" IsEditable="False" IsReadOnly="True" SelectionChanged="cmbModelChanged">
                                    <ComboBoxItem IsSelected="True" Content="sora-2" />
                                    <ComboBoxItem Content="sora-2-pro" />
                                </ComboBox>
                                <Label Content="Video Length" />
                                <ComboBox x:Name="cmbVideoLength" SelectionChanged="cmbVideoLengthChanged">
                                    <ComboBoxItem IsSelected="True" Content="4" />
                                    <ComboBoxItem Content="8" />
                                    <ComboBoxItem Content="12" />
                                </ComboBox>
                                <Label Content="Video Size" />
                                <ComboBox x:Name="cmbVideoSize" SelectionChanged="cmbVideoSizeChanged">
                                    <ComboBoxItem IsSelected="True" Content="720x1280" />
                                    <ComboBoxItem Content="1280x720" />
                                    <ComboBoxItem Content="1024x1792" />
                                    <ComboBoxItem Content="1792x1024" />
                                </ComboBox>

                                <Label Content="Input Reference - select an image" />
                                <Button x:Name="btnOpenVReference" Content="Choose Image" IsEnabled="True" Click="btnOpenVReference_Click"/>
                                <Image x:Name="imgVideo" Margin="0,5,0,0" MaxHeight="250" Stretch="Uniform" Source="/no_pic.png" />

                                <Button x:Name="btmRemoveImage" Content="Remove reference pic" IsEnabled="True" Click="btmRemoveImage_Click" />
                                <!-- Video history listbox with color-coded items -->
                                <ListBox x:Name="lstVideoFiles"
                                 ItemsSource="{Binding videoHistory}"
                                 SelectedItem="{Binding SelectedVideo}" SelectionChanged="lstVideoFiles_SelectionChanged">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Id}" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>

                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="Background" Value="White" />
                                            <Style.Triggers>
                                                <!-- Downloaded: light green -->
                                                <DataTrigger Binding="{Binding IsDownloaded}" Value="True">
                                                    <Setter Property="Background" Value="#FFC8FFC8"/>
                                                </DataTrigger>

                                                <!-- Error: light red -->
                                                <DataTrigger Binding="{Binding HasError}" Value="True">
                                                    <Setter Property="Background" Value="#FFFFC8C8"/>
                                                </DataTrigger>

                                                <!-- Not downloaded and no error: light orange -->
                                                <DataTrigger Binding="{Binding IsDownloaded}" Value="False">
                                                    <Setter Property="Background" Value="#FFFFE0B2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                </ListBox>
                                <CheckBox x:Name="cbVideoRemix" Content="Remix selected video" Margin="0,0,0,4"/>
                                <Button x:Name="btnDownloadVideo" Content="Download Selected Video" IsEnabled="True" Click="btnDownloadVideo_Click"/>
                                <Button x:Name="btnDeleteVideo" Content="Delete selected Video" IsEnabled="True" Click="btnDeleteVideo_Click" />
                                <Button x:Name="btnGetStatus" Content="GetVideoStatus" IsEnabled="True" Click="btnGetStatus_Click" />
                                <Button x:Name="btnPlayVideo" Content="Play Selected Video" IsEnabled="True" Click="btnPlayVideo_Click" />
                            </StackPanel>
                        </ScrollViewer>
                    </GroupBox>

                </Grid>
            </TabItem>
            <TabItem Header="Responses" Name="tpResponses" Height="20" VerticalAlignment="Bottom">
                <Grid x:Name="gridResponses" VerticalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="cdResponsesReqRes" Width="1.5*"/>
                        <ColumnDefinition x:Name="cdResponsesOptions" Width="0.5*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <GroupBox x:Name="groupIO" Header="IO" Grid.Row="0" Grid.Column="0" Grid.RowSpan="5" Margin="0">
                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <!-- prompt label + button -->
                                <RowDefinition Height="*"/>
                                <!-- prompt + image preview -->
                                <RowDefinition Height="Auto"/>
                                <!-- send button -->
                                <RowDefinition Height="Auto"/>
                                <!-- response label -->
                                <RowDefinition Height="*"/>
                                <!-- response textbox -->
                            </Grid.RowDefinitions>

                            <!-- 1) Prompt label and toggle button in one row -->
                            <Grid Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Label Grid.Column="0" Margin="2,0,2,2">
                                    Responses prompt
                                </Label>

                                <Button Grid.Column="1"
                    x:Name="btnResponsesAttachImage"
                    Margin="4,0,0,0"
                    Content="Attach image"
                    Click="btnResponsesAttachImage_Click"/>
                            </Grid>

                            <!-- 2) Prompt + image preview row -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <!-- Start at full width; will be changed in code -->
                                    <ColumnDefinition x:Name="colResponsesPrompt" Width="*" />
                                    <ColumnDefinition x:Name="colResponsesImage" Width="0" />
                                </Grid.ColumnDefinitions>

                                <!-- Prompt textbox -->
                                <TextBox Grid.Column="0"
                                     Style="{StaticResource TextBoxRequest}"
                                     x:Name="txtResponsesPrompt" />

                                <!-- Image preview area -->
                                <Border Grid.Column="1"
                                    x:Name="borderResponsesImage"
                                    Margin="4,0,0,0"
                                    BorderBrush="DarkGray"
                                    BorderThickness="1"
                                    Background="#FFF8F8F8"
                                    Visibility="Collapsed">
                                    <StackPanel Orientation="Vertical" Margin="4">
                                        <Label Content="Attached image" FontStyle="Italic" />
                                        <Image x:Name="imgResponsesPreview"
                                           Stretch="Uniform"
                                           MaxHeight="200"
                                           MouseLeftButtonDown="imgResponsesPreview_MouseLeftButtonDown">
                                            <Image.ContextMenu>
                                                <ContextMenu x:Name="ctxImagePreview">
                                                    <MenuItem Header="Open" Click="MenuItemImageOpen_Click"/>
                                                    <Separator/>
                                                    <MenuItem Header="Open with" Click="MenuItemImageOpenWith_Click" />
                                                </ContextMenu>
                                            </Image.ContextMenu>
                                        </Image>

                                        <Button x:Name="btnResponsesRemoveImage"
                            Content="Remove image"
                            Margin="0,4,0,0"
                            Click="btnResponsesRemoveImage_Click"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- 3) Send button -->
                            <Button Grid.Row="2"
                Style="{StaticResource SendRequest}"
                x:Name="btnResponsesSendRequest"
                Click="btnResponsesSendRequestClick"/>

                            <!-- 4) Response label -->
                            <Label Grid.Row="3" Margin="2,10,2,2">
                                OpenAi response
                            </Label>

                            <!-- 5) Response textbox -->
                            <TextBox Grid.Row="4"
                 Style="{StaticResource TextBoxResponse}"
                 x:Name="txtResponsesResponse" />
                        </Grid>
                    </GroupBox>


                    <GroupBox x:Name="groupResponses" Header="Responses Options" Grid.Row="0" Grid.Column="2" Grid.RowSpan="5">
                        <StackPanel x:Name="spResponses" Orientation="Vertical" Margin="5">
                            <Label Content="Model" />
                            <ComboBox x:Name="cmbResponsesModel" IsEditable="False" IsReadOnly="True" SelectionChanged="cmbResponsesModel_SelectionChanged" />
                            <Label Content="Reasoning" Margin="0,10,0,0"/>
                            <ComboBox x:Name="cmbReasoning" IsEditable="False" SelectionChanged="cmbReasoning_SelectionChanged">
                                <ComboBoxItem Content="none" IsSelected="True" Tag="none"/>
                                <ComboBoxItem Content="minimal" Tag="minimal"/>
                                <ComboBoxItem Content="low" Tag="low"/>
                                <ComboBoxItem Content="medium" Tag="medium"/>
                                <ComboBoxItem Content="high" Tag="high"/>
                                <ComboBoxItem Content="xhigh" Tag="xhigh"/>
                            </ComboBox>
                            <Label Content="Available Tools" />
                            <CheckBox x:Name="cbToolText"
          
                                  Content="Text (no tools)"
                                  IsChecked="True"
                                  Checked="cbTool_Checked"
                                  Unchecked="cbTool_Checked"/>
                            <Grid Margin="0,2,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <CheckBox x:Name="cbToolWebSearch"
                                          Grid.Column="0"
                                  Content="Web search"
                                  IsChecked="False"
                                  Checked="cbTool_Checked"
                                  Unchecked="cbTool_Checked"/>
                                <StackPanel Grid.Column="1"  Orientation="Vertical">
                                    <Label Content="Search Context Size" />
                                    <ComboBox x:Name="cmbSearchContextSize"
                                
                                SelectedIndex="1"  
                                SelectionChanged="cmbSearchContextSize_SelectionChanged">
                                        <ComboBoxItem Content="low" Tag="low"/>
                                        <ComboBoxItem Content="medium" Tag="medium"/>
                                        <ComboBoxItem Content="high" Tag="high"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                            <CheckBox x:Name="cbToolComputerUse"
                                  Content="Computer use (preview)"
                                  IsChecked="False"
                                  Checked="cbTool_Checked"
                                  Unchecked="cbTool_Checked"/>
                            <Grid Margin="0,2,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <CheckBox x:Name="cbToolImageGeneration" Grid.Column="0"
                                  Content="Image Generation"
                                  IsChecked="False"
                                  Checked="cbTool_Checked"
                                  Unchecked="cbTool_Checked"/>
                                <StackPanel Grid.Column="1"  Orientation="Vertical">
                                    <Label Content="Image Quality" />
                                    <ComboBox x:Name="cmbImageGenQuality" IsEnabled="False" SelectionChanged="cmbImageGenQuality_SelectionChanged">
                                        <ComboBoxItem Content="auto" Tag="auto" IsSelected="True"/>
                                        <ComboBoxItem Content="low" Tag="low"/>
                                        <ComboBoxItem Content="medium" Tag="medium"/>
                                        <ComboBoxItem Content="high" Tag="high"/>
                                    </ComboBox>
                                    <Label Content="Image Size" Margin="0,5,0,0"/>
                                    <ComboBox x:Name="cmbImageGenSize"  IsEnabled="False" SelectionChanged="cmbImageGenSize_SelectionChanged" Margin="0,0,0,5" >
                                        <ComboBoxItem Content="auto" Tag="auto" IsSelected="True"/>
                                        <ComboBoxItem Content="1024x1024" Tag="1024x1024"/>
                                        <ComboBoxItem Content="1536x1024" Tag="1536x1024" />
                                        <ComboBoxItem Content="1024x1536" Tag="1024x1536"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>
                            <Button x:Name="btnResponsesNewChat" Content="New Conversation" Click="btnResponsesNewChat_Click"/>
                            <ListBox x:Name="lstResponsesTurns" Height="150" SelectionChanged="lstResponsesTurns_SelectionChanged" MouseDoubleClick="lstResponsesTurns_MouseDoubleClick">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Margin="5">
                                            <TextBlock Text="{Binding Role}" FontWeight="Bold" Foreground="Gray" FontSize="10"/>
                                            <TextBlock Text="{Binding Content}" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            <Button x:Name="btnResponsesDeleteChat" Content="Delete Conversation" Click="btnResponsesDeleteChat_Click"/>
                        </StackPanel>


                    </GroupBox>

                </Grid>
            </TabItem>
            <TabItem Header="Logs" x:Name="tabLogs">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Orientation="Horizontal" Margin="10,5">
                        <TextBlock Text="Filter by Type: " VerticalAlignment="Center" Margin="0,0,5,0"/>
                        <ComboBox x:Name="cbLogTypeFilter" Width="120" SelectionChanged="OnLogFilterChanged">
                            <ComboBoxItem Content="All"/>
                            <ComboBoxItem Content="Images"/>
                            <ComboBoxItem Content="Web"/>
                        </ComboBox>
                        <Label Content="Search Logs:" VerticalAlignment="Center"/>
                        <TextBox x:Name="txtLogSearch" Width="300" Margin="10,0" TextChanged="TxtLogSearch_TextChanged"/>
                    </StackPanel>

                    <DataGrid x:Name="dgUnifiedLogs" 
                      Grid.Row="1" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      SelectionMode="Single"
                      SelectionUnit="FullRow"
                      MouseDoubleClick="OnLogEntryDoubleClick"
                      Background="White"
                      RowBackground="White"
                      AlternatingRowBackground="#F9F9F9"
                      Margin="10">  
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date" Binding="{Binding LastUsedAt, StringFormat=\{0:dd.MM HH:mm\}}" Width="100"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Endpoint}" Width="80"/>

                            <DataGridTextColumn Header="Last Prompt" Binding="{Binding Title}" Width="250">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>

                            <DataGridTemplateColumn Width="50" Header="Del">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="🗑" 
                                            Click="OnDeleteSessionClick" 
                                            Focusable="False"
                                            Background="Transparent" 
                                            BorderThickness="0"
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Ready" />
            </StatusBarItem>
        </StatusBar>
    </DockPanel>
</Window>
